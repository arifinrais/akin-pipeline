<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
    
    <title>Pipeline Monitor</title>
  </head>
  <body>
    
    <nav class="navbar navbar-light bg-light justify-content-center text-align-center">
      <div class="container-fluid">
        <span class="navbar-brand mb-0 h1">Pipeline Monitor</span>
      </div>
    </nav>

    <ul class="nav nav-tabs nav-fill" id="myTab" role="tablist">
      <li class="nav-item" role="presentation">
        <button class="nav-link active" id="patent-tab" data-bs-toggle="tab" data-bs-target="#patent" type="button" role="tab" aria-controls="patent" aria-selected="true">Patent</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="publication-tab" data-bs-toggle="tab" data-bs-target="#publication" type="button" role="tab" aria-controls="publication" aria-selected="false">Trademark</button>
      </li>
      <li class="nav-item" role="presentation">
        <button class="nav-link" id="trademark-tab" data-bs-toggle="tab" data-bs-target="#trademark" type="button" role="tab" aria-controls="trademark" aria-selected="false">Publication</button>
      </li>
    </ul>
    <div class="tab-content" id="myTabContent">
      <div class="tab-pane fade show active" id="patent" role="tabpanel" aria-labelledby="patent-tab">
        <div class="col-lg-8 pb-5">
          <div class="table-responsive">
              <table class="table table-hover mb-0">
                  <thead>
                      <tr>
                          <th>Year</th>
                          <th>Ingestion</th>
                          <th>Aggregation</th>
                          <th>Transformation</th>
                          <th>Analysis</th>
                      </tr>
                  </thead>
                  <tbody id="result-patent">
                
                  </tbody>
              </table>
          </div>
        </div>
      </div>
      <div class="tab-pane fade" id="publication" role="tabpanel" aria-labelledby="publication-tab">
        <div class="col-lg-8 pb-5">
          <div class="table-responsive">
              <table class="table table-hover mb-0">
                  <thead>
                      <tr>
                          <th>Year</th>
                          <th>Ingestion</th>
                          <th>Aggregation</th>
                          <th>Transformation</th>
                          <th>Analysis</th>
                      </tr>
                  </thead>
                  <tbody id="result-publication">
                
                  </tbody>
              </table>
          </div>
        </div>
      </div>
      <div class="tab-pane fade" id="trademark" role="tabpanel" aria-labelledby="trademark-tab">
        <div class="col-lg-8 pb-5">
          <div class="table-responsive">
              <table class="table table-hover mb-0">
                  <thead>
                      <tr>
                          <th>Year</th>
                          <th>Ingestion</th>
                          <th>Aggregation</th>
                          <th>Transformation</th>
                          <th>Analysis</th>
                      </tr>
                  </thead>
                  <tbody id="result-trademark">
                
                  </tbody>
              </table>
          </div>
        </div>
      </div>
    </div>
    <!-- Optional JavaScript; choose one of the two! -->

    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>

    <!-- Option 2: Separate Popper and Bootstrap JS -->
    <!--
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js" integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js" integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF" crossorigin="anonymous"></script>
    -->
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script>
      $SCRIPT_ROOT = {{ request.script_root|tojson }};
    </script>
    <script type=text/javascript>
      function getStatus(obj_list) {

        var temp = [];
        obj_list.forEach((element) => {
          temp_string = "<tr><td>"+element.year+"</td><td>"
          if (element.job=='ing') {
            temp.push(temp_string+element.status+"</td><td>-</td><td>-</td><td>-</td></tr>")
            } else if (element.job=='agg') {
              temp.push(temp_string+"done</td><td>"+element.status+"</td><td>-</td><td>-</td></tr>")
            } else if (element.job=='tfm') {
              temp.push(temp_string+"done</td><td>done</td><td>"+element.status+"</td><td>-</td></tr>")
            } else if (element.job=='anl') {
              temp.push(temp_string+"done</td><td>done</td><td>done</td><td>"+element.status+"</td></tr>")
            }
        });
        return temp
      }

      function getStatuses(obj_list, element_id) {
        var list_data = getStatus(obj_list);
        list_data.forEach((element) => {
          $("#"+element_id).append(element)
        });
      }

      function defaultStatus(element_id) {
        var default_string = "<tr><td>-</td><td>-</td><td>-</td><td>-</td><td>-</td></tr>"
        $("#"+element_id).append(default_string)
      }

      function loadStatus(data) {
        if (data.patent.length!=0) {
          getStatuses(data.patent, 'result-patent')
        } else {
          defaultStatus('result-patent')
        }
        if (data.publication.length!=0) {
          getStatuses(data.publication, 'result-publication')
        } else {
          defaultStatus('result-publication')
        }
        
        if (data.trademark.length!=0) {
          getStatuses(data.trademark, 'result-trademark')
        } else {
          defaultStatus('result-trademark')
        }
      }

      function sayHi() {
        $.getJSON(                            
                $SCRIPT_ROOT + '/get_values',      
                {},                                
                function(data)                     
                {
                  loadStatus(data);
                });
      }
      sayHi();
      setInterval(sayHi, 60000);
    
    </script>
  </body>
</html>